<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="styles/styles.css">
</head>

<body>
  <h1>Selecione uma Igreja</h1>
  

  <select id="igreja-select"> 
    <option value="">Selecione uma igreja...</option>
  </select>
  
  <div id="data-container" style="display: none;">

  </div>

  <script type="module">
    // Firebase imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, getDocs, getDoc, doc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    // Configuração e inicialização do Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyA7Q4Bw71c0aRi6nMyhQznR9ZMlWFBpolg",
      authDomain: "atv-ext-uninter.firebaseapp.com",
      projectId: "atv-ext-uninter",
      storageBucket: "atv-ext-uninter.firebasestorage.app",
      messagingSenderId: "937201550634",
      appId: "1:937201550634:web:f13f79cb3a8a195c1e8a53"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Executa o código após o DOM estar completamente carregado
    document.addEventListener("DOMContentLoaded", () => {
      const igrejaSelect = document.getElementById("igreja-select");
      const dataContainer = document.getElementById("data-container");

      // Função para carregar as igrejas no dropdown
      async function loadIgrejas() {
        try {
          const querySnapshot = await getDocs(collection(db, "igrejas"));
          querySnapshot.forEach((doc) => {
            const data = doc.data();
            const option = document.createElement("option");
            option.value = doc.id; // Usando o ID do documento
            option.textContent = data.nome; // Nome da igreja
            igrejaSelect.appendChild(option);
          });
        } catch (error) {
          console.error("Erro ao carregar igrejas: ", error);
        }
      }

      // Função para exibir informações da igreja selecionada
      // Função para exibir informações da igreja selecionada
// Função para exibir informações da igreja selecionada
async function displayIgrejaInfo(id) {
  try {
    // Limpar o contêiner antes de adicionar novas informações
    dataContainer.innerHTML = "";

    // Obter os dados da igreja selecionada (nome e endereço)
    const igrejaDoc = await getDocs(collection(db, "igrejas", id, "missas"));
    const igrejaData = await getDoc(doc(db, "igrejas", id));

    if (igrejaData.exists()) {
      const data = igrejaData.data();
      const nomeIgreja = data.nome;
      const endereco = data.endereço;

      // Construir HTML para exibir o nome e endereço da igreja
      let igrejaHTML = `
        <div>
          <h2>${nomeIgreja}</h2>
          <p><strong>Endereço:</strong> ${endereco}</p>
        </div>
      `;

      // Caso não tenha missas
      if (igrejaDoc.empty) {
        dataContainer.innerHTML = igrejaHTML + "<p>Sem horários de missas disponíveis.</p>";
        return;
      }

      // Definir a ordem dos dias da semana, começando por domingo
      const diasSemana = ["domingo", "segunda-feira", "terça-feira", "quarta-feira", "quinta-feira", "sexta-feira", "sábado"];

      // Organizar os documentos na ordem dos dias da semana
      const missasOrdenadas = [];
      igrejaDoc.forEach((doc) => {
        missasOrdenadas.push({ id: doc.id, data: doc.data() });
      });

      missasOrdenadas.sort((a, b) => diasSemana.indexOf(a.id.toLowerCase()) - diasSemana.indexOf(b.id.toLowerCase()));

      // Construir HTML para os dias e horários
      let missasHTML = "<ul>";
      missasOrdenadas.forEach((doc) => {
        const dia = doc.id;
        const horarios = doc.data.horarios || [];

        missasHTML += `
          <li>
            <strong>${dia}</strong>
            <ul>
              ${horarios.map((horario) => `<li>${horario}</li>`).join("")}
            </ul>
          </li>
        `;
      });
      missasHTML += "</ul>";

      // Exibir nome, endereço e horários no contêiner
      dataContainer.innerHTML = igrejaHTML + `
        <div>
          <p><strong>Horários de Missas:</strong></p>
          ${missasHTML}
        </div>
      `;
      dataContainer.style.display = "block"; // Exibe o contêiner
    } else {
      dataContainer.innerHTML = "<p>Informações da igreja não encontradas.</p>";
    }
  } catch (error) {
    console.error("Erro ao exibir informações da igreja: ", error);
    dataContainer.innerHTML = "<p>Erro ao carregar informações.</p>";
  }
}


      // Evento de mudança no dropdown
      igrejaSelect.addEventListener("change", (event) => {
        const selectedId = event.target.value;
        if (selectedId) {
          displayIgrejaInfo(selectedId);
        } else {
          dataContainer.style.display = "none"; // Oculta o contêiner
        }
      });

      // Carregando as igrejas no dropdown ao iniciar
      loadIgrejas();
    });
  </script>


</body>
</html>
